<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>Dyestuff Swatch Explorer — Polar & Grid (v2.3)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --border:#e5e7eb;
      --ink:#0b0b0c;
      --muted:#6b7280;
      --bg:#ffffff;
    }
    * { box-sizing:border-box; }
    body {
      margin:0;
      font:14px/1.45 system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
           Roboto, Helvetica, Arial, sans-serif;
      background:var(--bg);
      color:var(--ink);
    }
    header {
      padding:12px 16px;
      border-bottom:1px solid var(--border);
      font-weight:600;
    }
    header small { font-weight:400; color:var(--muted); }

    .app {
      display:grid;
      grid-template-columns: 280px 1fr 320px;
      height:calc(100vh - 46px);
    }
    aside.left {
      border-right:1px solid var(--border);
      padding:10px;
      overflow:auto;
    }
    aside.right {
      border-left:1px solid var(--border);
      padding:10px;
      overflow:auto;
    }
    main {
      padding:10px;
      overflow:auto;
      display:flex;
      flex-direction:column;
      gap:8px;
    }

    .panel {
      border:1px solid var(--border);
      border-radius:10px;
      padding:10px;
      margin-bottom:10px;
    }
    .panel h3 {
      margin:0 0 6px 0;
      font-size:13px;
      font-weight:600;
    }
    .panel small { color:var(--muted); }

    .row {
      display:flex;
      gap:6px;
      align-items:center;
      margin-bottom:8px;
      flex-wrap:wrap;
    }
    label b { font-weight:600; }

    input[type="number"],
    select {
      padding:4px 6px;
      border:1px solid var(--border);
      border-radius:8px;
      font-size:13px;
    }
    input[type="range"] {
      width:120px;
    }
    button {
      padding:6px 10px;
      border-radius:8px;
      border:1px solid var(--border);
      background:#fafafa;
      cursor:pointer;
      font-size:13px;
    }
    button:disabled { opacity:0.5; cursor:default; }

    .pill {
      font-size:11px;
      background:#f3f4f6;
      border:1px solid var(--border);
      border-radius:999px;
      padding:2px 6px;
    }
    .muted { color:var(--muted); }

    .filter-group {
      margin-bottom:8px;
      border-top:1px solid #f3f4f6;
      padding-top:6px;
    }
    .filter-group:first-child { border-top:none; padding-top:0; }
    .filter-group-title {
      font-size:12px;
      font-weight:600;
      margin-bottom:4px;
    }
    .filter-chips {
      display:flex;
      flex-wrap:wrap;
      gap:4px;
    }
    .chip {
      display:inline-flex;
      align-items:center;
      gap:2px;
      font-size:11px;
      padding:2px 6px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#f9fafb;
    }
    .chip input {
      margin:0;
    }

    canvas#view {
      border:1px solid var(--border);
      border-radius:12px;
      background:#ffffff;
      max-width:100%;
      height:auto;
    }

    #info { font-size:12px; color:var(--muted); }

    /* right sidebar stuff */
    .thumbWrap, .hoverWrap, .displayWrap {
      border:1px solid var(--border);
      border-radius:10px;
      padding:8px;
      margin-bottom:10px;
    }
    .thumbWrap h4, .hoverWrap h4, .displayWrap h4 {
      margin:0 0 6px 0;
      font-size:13px;
    }
    #thumb {
      display:none;
      width:100%;
      height:auto;
      border-radius:6px;
      border:1px solid var(--border);
      background:#f9fafb;
    }
    #hoverSwatch {
      width:100%;
      max-width:180px;
      height:auto;
      aspect-ratio:1/1;
      border-radius:8px;
      border:1px solid var(--border);
      background:#fff;
    }
    #hoverMeta {
      font-size:12px;
    }
    #hoverMeta .sep {
      margin:6px 0;
      height:1px;
      background:var(--border);
    }
    #hoverMeta .row {
      margin-bottom:2px;
    }

    .grid-only { display:none; } /* will be shown in JS when mode=grid */

    @media (max-width: 960px) {
      .app {
        grid-template-columns: 1fr;
        grid-template-rows: auto auto auto;
        height:auto;
      }
      aside.left, aside.right, main {
        border:none;
        height:auto;
      }
      aside.left { border-bottom:1px solid var(--border); }
      aside.right { border-top:1px solid var(--border); }
    }
  </style>
</head>
<body>
  <header>
    Dyestuff Swatch Explorer — Polar &amp; Grid (v2.3)
    <small> · imagesBordered + imagesSuperCrop · swatch_lookup.json</small>
  </header>

  <div class="app">
    <!-- LEFT SIDEBAR: filters & controls -->
    <aside class="left">
      <div class="panel">
        <h3>Data</h3>
        <div class="row">
          <button id="loadBtn">Load swatches</button>
          <span id="status" class="pill">idle</span>
        </div>
        <small class="muted">
          Uses <code>swatch_lookup.json</code>, <code>imagesBordered/</code> (display) and <code>imagesSuperCrop/</code> (hover preview).
        </small>
      </div>

      <div class="panel">
        <h3>Display</h3>
        <div class="row">
          <label><input type="radio" name="mode" value="polar" checked> Polar (HSB wheel)</label>
        </div>
        <div class="row">
          <label><input type="radio" name="mode" value="grid"> Grid (axes)</label>
        </div>
        <div class="row">
          <label><input id="showGuides" type="checkbox" checked> Show guides / axes</label>
        </div>
        <div class="row">
          <label><b>Zoom</b></label>
          <input id="zoom" type="range" min="0.5" max="2.0" value="1.0" step="0.05">
          <span id="zoomVal" class="pill">1.0×</span>
        </div>
        <div class="row">
          <label><b>Swatch size</b></label>
          <input id="swatchSize" type="range" min="6" max="40" value="14">
          <span id="swatchSizeVal" class="pill">14px</span>
        </div>
      </div>

      <div class="panel grid-only" id="gridSettings">
        <h3>Grid axes</h3>
        <div class="row">
          <label><b>Outer X</b></label>
          <select id="gridOuterX"></select>
        </div>
        <div class="row">
          <label><b>Outer Y</b></label>
          <select id="gridOuterY"></select>
        </div>
        <div class="row">
          <label><b>Inner X′</b></label>
          <select id="gridInnerX"></select>
        </div>
        <div class="row">
          <label><b>Inner Y′</b></label>
          <select id="gridInnerY"></select>
        </div>
        <small class="muted">
          Within each outer X×Y cell, swatches are arranged along X′ and Y′.
        </small>
      </div>

      <div class="panel">
        <h3>Filters</h3>

        <div class="filter-group">
          <div class="filter-group-title">Dyestuff</div>
          <div id="filterDyestuff" class="filter-chips"></div>
        </div>

        <div class="filter-group">
          <div class="filter-group-title">pH</div>
          <div id="filterPH" class="filter-chips"></div>
        </div>

        <div class="filter-group">
          <div class="filter-group-title">Mordant</div>
          <div id="filterMordant" class="filter-chips"></div>
        </div>

        <div class="filter-group">
          <div class="filter-group-title">Additive</div>
          <div id="filterAdditive" class="filter-chips"></div>
        </div>

        <div class="filter-group">
          <div class="filter-group-title">Time</div>
          <div id="filterTime" class="filter-chips"></div>
        </div>

        <div class="row">
          <button id="selectAll">Select all</button>
          <button id="clearAll">Clear all</button>
        </div>
      </div>
    </aside>

    <!-- CENTER: canvas -->
    <main>
      <canvas id="view" width="900" height="900"></canvas>
      <small id="info" class="muted">Load swatches to begin.</small>
    </main>

    <!-- RIGHT SIDEBAR: thumb + hovered swatch + quick settings -->
    <aside class="right">
      <div class="thumbWrap">
        <h4>Original colour wheel thumbnail</h4>
        <canvas id="thumb"></canvas>
        <small class="muted">
          Currently mirrors the main view. Future version can hold a captured snapshot.
        </small>
      </div>

      <div class="hoverWrap">
        <h4>Hovered swatch</h4>
        <div class="row" style="align-items:flex-start;">
          <canvas id="hoverSwatch" width="180" height="180"></canvas>
          <div id="hoverMeta">
            <div class="row"><b>File:</b>&nbsp;<span data-field="filename">—</span></div>
            <div class="row"><b>Dye:</b>&nbsp;<span data-field="dyestuff">—</span></div>
            <div class="row"><b>pH:</b>&nbsp;<span data-field="pH">—</span></div>
            <div class="row"><b>Mordant:</b>&nbsp;<span data-field="mordant">—</span></div>
            <div class="row"><b>Additive:</b>&nbsp;<span data-field="additive">—</span></div>
            <div class="row"><b>Time:</b>&nbsp;<span data-field="time">—</span></div>
            <div class="sep"></div>
            <div class="row">
              <b>H:</b>&nbsp;<span data-field="H">—</span>&nbsp;&nbsp;
              <b>S:</b>&nbsp;<span data-field="S">—</span>&nbsp;&nbsp;
              <b>B:</b>&nbsp;<span data-field="B">—</span>
            </div>
          </div>
        </div>
        <small class="muted">Move the mouse over the canvas to inspect a swatch.</small>
      </div>

      <div class="displayWrap">
        <h4>Quick view info</h4>
        <div class="row">
          <span class="pill" id="countTotal">Total: 0</span>
          <span class="pill" id="countFiltered">Shown: 0</span>
        </div>
        <small class="muted">
          v2.3 · Polar/HSB and Grid layouts. Data source: <code>swatch_lookup.json</code>.
        </small>
      </div>
    </aside>
  </div>

  <script src="script.js"></script>
</body>
</html>
